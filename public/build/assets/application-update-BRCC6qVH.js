import{u as M,r,b as N,j as e,U as y,d2 as k,da as O,ch as V,e as G}from"./vendor-BBDGfIfP.js";import{C as Z}from"./chunked-uploader-input-BS9NXBbE.js";import{I as q}from"./input-error-DzlB5Qkt.js";import{L as h}from"./loading-button-BLSSbYXc.js";import{B as p}from"./button-BxbUMaK9.js";import{C as J,a as K,b as Q}from"./card-XBn4TxoT.js";import{D as S,a as W,b as C,d as U,g as D,e as F,f as R,c as X}from"./dialog-Ao4xhLhR.js";import{L as Y}from"./label-DUVUvbLf.js";import{S as $}from"./scroll-area-Dmjd_gyP.js";import"./input-Dldj9DiJ.js";import"./utils-fgVZ67ei.js";import"./index-G4n3qM_p.js";import"./index-BSu11NtU.js";const ue=({version:d})=>{const{props:m}=M(),u=(m==null?void 0:m.translate)||{},i=(u==null?void 0:u.settings)||{},s={application_update:i.application_update||"Application Update",upload_install_latest:i.upload_install_latest||"Upload and install the latest version of your application",important_update_guidelines:i.important_update_guidelines||"Important Update Guidelines",refresh_server:i.refresh_server||"Refresh Server",backup_first:i.backup_first||"Backup First",file_format:i.file_format||"File Format",maintenance_mode:i.maintenance_mode||"Maintenance Mode",migrations:i.migrations||"Migrations",downtime:i.downtime||"Downtime",browser:i.browser||"Browser",seeder:i.seeder||"Seeder",refresh_server_guideline:i.refresh_server_guideline||"Every time refresh server before updating",backup_first_guideline:i.backup_first_guideline||"Always create a backup before updating",file_format_guideline:i.file_format_guideline||"Upload must be a valid ZIP file",maintenance_mode_guideline:i.maintenance_mode_guideline||"Site will be temporarily unavailable during update",migrations_guideline:i.migrations_guideline||"Database migrations will be automatically applied",downtime_guideline:i.downtime_guideline||"Update process may take several minutes",browser_guideline:i.browser_guideline||"Do not refresh or close browser during update",seeder_guideline:i.seeder_guideline||"Run seeder only after updating the application version",uploading:i.uploading||"Uploading...",updating_application:i.updating_application||"Updating application...",update_application:i.update_application||"Update Application",confirm_application_update:i.confirm_application_update||"Confirm Application Update",confirm_update_with_file:i.confirm_update_with_file||'Are you sure you want to update the application with ":filename"?',this_update_will:i.this_update_will||"This update will:",put_site_in_maintenance:i.put_site_in_maintenance||"Put the site in maintenance mode",replace_all_files:i.replace_all_files||"Replace all application files",run_database_migrations:i.run_database_migrations||"Run database migrations",may_take_minutes:i.may_take_minutes||"Process may take several minutes",important_warning:i.important_warning||"⚠️ Important:",backup_first_warning:i.backup_first_warning||"Make sure you have created a backup first! This action cannot be undone.",select_zip_only:i.select_zip_only||"Select File (.zip only)",selected_file:i.selected_file||"Selected file:",file_selected_click_update:i.file_selected_click_update||'File selected successfully. Click "Update Application" to proceed.',close:i.close||"Close",please_do_not_close:i.please_do_not_close||"Please do not close this window",run_version_seeder:i.run_version_seeder||"Run :version Version Seeder",run_version_seeder_title:i.run_version_seeder_title||"Run Version :version Seeder",run_seeder_description:i.run_seeder_description||"This will run the database seeder for version :version.",seeder_important_notes:i.seeder_important_notes||"Important Notes:",seeder_note_1:i.seeder_note_1||"Run this seeder only once after updating to version :version",seeder_note_2:i.seeder_note_2||"Running this multiple times will overwrite existing data",seeder_note_3:i.seeder_note_3||"Do not run this seeder after you have added your own content to the website",cancel:i.cancel||"Cancel",run_seeder:i.run_seeder||"Run Seeder"},[A,o]=r.useState(!1),[x,g]=r.useState(!1),[a,f]=r.useState(!1),[c,j]=r.useState(!1),[_,b]=r.useState(""),{data:v,setData:I,post:E,errors:z,processing:n,reset:B}=N({update_file_url:""}),w=N({}),T=()=>{w.post(route("system.refresh"))},P=async t=>{if(t.preventDefault(),c){f(!0);return}},l=()=>{f(!1),j(!1),b(""),B("update_file_url")};r.useEffect(()=>{v.update_file_url&&a&&E(route("system.update"),{onSuccess:()=>{o(!1),l()},onError:()=>{l()}})},[v.update_file_url]);const H=t=>{a?o(!0):(o(t),t||l())},L=()=>{g(!0),G.get(route("system.update.seeder"),{},{onFinish:()=>g(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(J,{className:"border-2",children:[e.jsxs(K,{className:"p-4 sm:p-6",children:[e.jsxs("h2",{className:"flex items-center gap-2 text-xl font-semibold",children:[e.jsx(y,{className:"text-warning h-5 w-5"}),s.application_update]}),e.jsx("p",{className:"text-muted-foreground mt-1 text-sm",children:s.upload_install_latest})]}),e.jsxs(Q,{className:"space-y-6 p-4 pt-0 sm:p-6 sm:pt-0",children:[e.jsx("div",{className:"dark:bg-secondary dark:border-border rounded-lg border border-amber-200 bg-amber-50 p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(k,{className:"h-5 w-5 text-amber-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-amber-800",children:s.important_update_guidelines}),e.jsx("div",{className:"mt-2 text-sm text-amber-700",children:e.jsxs("ul",{className:"list-inside list-disc space-y-1",children:[e.jsxs("li",{children:[e.jsxs("strong",{children:[s.refresh_server,":"]})," ",s.refresh_server_guideline]}),e.jsxs("li",{children:[e.jsxs("strong",{children:[s.backup_first,":"]})," ",s.backup_first_guideline]}),e.jsxs("li",{children:[e.jsxs("strong",{children:[s.file_format,":"]})," ",s.file_format_guideline]}),e.jsxs("li",{children:[e.jsxs("strong",{children:[s.maintenance_mode,":"]})," ",s.maintenance_mode_guideline]}),e.jsxs("li",{children:[e.jsxs("strong",{children:[s.migrations,":"]})," ",s.migrations_guideline]}),e.jsxs("li",{children:[e.jsxs("strong",{children:[s.downtime,":"]})," ",s.downtime_guideline]}),e.jsxs("li",{children:[e.jsxs("strong",{children:[s.browser,":"]})," ",s.browser_guideline]}),e.jsxs("li",{children:[e.jsxs("strong",{children:[s.seeder,":"]})," ",s.seeder_guideline]})]})})]})]})}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row",children:[e.jsx(h,{type:"button",variant:"secondary",onClick:T,loading:w.processing,disabled:n||a,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{children:s.refresh_server})]})}),e.jsxs(p,{type:"button",onClick:()=>o(!0),children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{children:a?s.uploading:n?s.updating_application:s.update_application})]}),e.jsxs(S,{children:[e.jsx(W,{asChild:!0,children:e.jsx(p,{variant:"ghost",className:"bg-destructive/8 hover:bg-destructive/6 text-destructive hover:text-destructive",children:s.run_version_seeder.replace(":version",d)})}),e.jsxs(C,{children:[e.jsx(U,{children:s.run_version_seeder_title.replace(":version",d)}),e.jsxs(D,{className:"space-y-2",children:[e.jsx("p",{children:s.run_seeder_description.replace(":version",d)}),e.jsxs("div",{className:"rounded-md bg-yellow-50 p-3 text-sm text-yellow-700",children:[e.jsx("p",{className:"font-medium",children:s.seeder_important_notes}),e.jsxs("ul",{className:"mt-1 list-inside list-disc space-y-1",children:[e.jsx("li",{children:s.seeder_note_1.replace(":version",d)}),e.jsx("li",{children:s.seeder_note_2}),e.jsx("li",{children:s.seeder_note_3})]})]})]}),e.jsxs(F,{className:"gap-2",children:[e.jsx(R,{asChild:!0,children:e.jsx(p,{type:"button",variant:"secondary",children:s.cancel})}),e.jsx(h,{variant:"destructive",loading:x,disabled:x,className:"text-primary-foreground",onClick:L,children:s.run_seeder})]})]})]})]})]})]}),e.jsx(S,{open:A,onOpenChange:H,children:e.jsxs(C,{className:"sm:max-w-[500px]",children:[n&&e.jsx("div",{className:"bg-background/80 absolute inset-0 z-50 flex items-center justify-center rounded-lg backdrop-blur-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"border-primary mx-auto mb-4 h-8 w-8 animate-spin rounded-full border-4 border-t-transparent"}),e.jsx("p",{className:"text-sm font-medium",children:s.updating_application}),e.jsx("p",{className:"text-muted-foreground mt-1 text-xs",children:s.please_do_not_close})]})}),e.jsxs($,{className:"max-h-[90vh]",children:[e.jsxs(X,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-orange-600"}),s.confirm_application_update]}),e.jsxs(D,{className:"space-y-4 text-left",children:[e.jsx("p",{children:s.confirm_update_with_file.replace(":filename",_)}),e.jsxs("div",{className:"rounded-lg border border-orange-200 bg-orange-50 p-4",children:[e.jsx("p",{className:"mb-2 font-medium text-orange-800",children:s.this_update_will}),e.jsxs("ul",{className:"list-inside list-disc space-y-1 text-sm text-orange-700",children:[e.jsx("li",{children:s.put_site_in_maintenance}),e.jsx("li",{children:s.replace_all_files}),e.jsx("li",{children:s.run_database_migrations}),e.jsx("li",{children:s.may_take_minutes})]})]}),e.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4",children:[e.jsx("p",{className:"mb-1 font-medium text-red-800",children:s.important_warning}),e.jsx("p",{className:"text-sm text-red-700",children:s.backup_first_warning})]})]})]}),e.jsxs("form",{onSubmit:P,className:"space-y-4 pt-4",children:[e.jsxs("div",{children:[e.jsx(Y,{children:s.select_zip_only}),e.jsx(Z,{isSubmit:a,storage:"local",filetype:"zip",delayUpload:!1,onFileSelected:t=>{j(!0),b(t.name)},onFileUploaded:t=>{I("update_file_url",t.file_url)},onError:t=>{l()},onCancelUpload:()=>{l()}}),e.jsx(q,{message:String(z.update_file_url||"")})]}),c&&_&&e.jsx("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(V,{className:"mt-0.5 h-4 w-4 text-green-600"}),e.jsxs("div",{className:"ml-2",children:[e.jsxs("p",{className:"text-sm text-green-800",children:[e.jsx("strong",{children:s.selected_file})," ",_]}),e.jsx("p",{className:"mt-1 text-xs text-blue-600",children:s.file_selected_click_update})]})]})}),e.jsxs(F,{className:"w-full justify-between space-x-2 pt-8",children:[e.jsx(R,{asChild:!0,children:e.jsx(p,{type:"button",variant:"outline",children:s.close})}),e.jsx(h,{type:c?"submit":"button",disabled:n||a||!c,loading:n||a,children:a?s.uploading:s.update_application})]})]})]})]})})]})};export{ue as default};
