import{r as c,u as A,b as Y,j as e}from"./vendor-BBDGfIfP.js";import{C as J}from"./chunked-uploader-input-BS9NXBbE.js";import{I as u}from"./input-error-DzlB5Qkt.js";import{L as K}from"./loading-button-BLSSbYXc.js";import{T as Q}from"./tabs-BBlGrPJc.js";import{B as v}from"./button-BxbUMaK9.js";import{D as W,a as X,b as Z,c as ee,d as se,e as re,f as ae}from"./dialog-Ao4xhLhR.js";import{I as b}from"./input-Dldj9DiJ.js";import{L as o}from"./label-DUVUvbLf.js";import{R as L,a as w}from"./radio-group-CBkhOvCv.js";import{S as le}from"./scroll-area-Dmjd_gyP.js";import{S as oe,a as te,b as ie,c as ne,d as de}from"./select-CMFY0w3t.js";import{b as D,T as ce,a as U}from"./tabs-Dr9vs2WG.js";import{T as ue}from"./textarea-ovCXlSTO.js";import{g as me}from"./file-metadata-CAFSN-Sn.js";import{o as y}from"./inertia-SZXqLvQm.js";import{c as C}from"./utils-fgVZ67ei.js";import{k as E}from"./richtor-QjVY_KZS.js";import"./index-G4n3qM_p.js";import"./index-BSu11NtU.js";const pe=i=>[{value:"video",label:i.dashboard.video_file,flag:!1},{value:"video_url",label:i.dashboard.video_url,flag:!1},{value:"document",label:i.dashboard.document_file,flag:!1},{value:"image",label:i.dashboard.image_file,flag:!1},{value:"text",label:i.dashboard.text_content,flag:!1},{value:"embed",label:i.dashboard.embed_source,flag:!1}],qe=({title:i,handler:V,lesson:r,sectionId:k})=>{const[_,h]=c.useState(!1),[m,p]=c.useState(!1),[x,S]=c.useState("type"),[q,H]=c.useState(!1),[M,T]=c.useState(!1),{props:f}=A(),{translate:N}=f,{dashboard:he,input:t,button:g}=N,R=pe(N),{data:a,setData:l,post:B,put:O,reset:j,processing:F,errors:n,clearErrors:P}=Y({title:r?r.title:"",status:r?r.status:"",is_free:r?r.is_free:0,description:r?r.description:"",sort:r?r.sort:f.lastLessonSort+1,lesson_type:r?r.lesson_type:"video",lesson_provider:r?r.lesson_provider:"",lesson_src:r?r.lesson_src:"",lesson_src_new:null,embed_source:r?r.embed_source:"",duration:r?r.duration:"00:00:00",summary:r?r.summary:"",course_id:r?r.course_id:f.course.id,course_section_id:k}),G=["video","document","image"].includes(a.lesson_type),$=async s=>{if(s.preventDefault(),G&&q){p(!0);return}I()},I=()=>{P(),r?O(route("lesson.update",{id:r.id}),{preserveScroll:!0,onSuccess:()=>{j(),h(!1),p(!1)}}):B(route("lesson.store"),{preserveScroll:!0,onSuccess:()=>{j(),h(!1),p(!1)}})};c.useEffect(()=>{a.lesson_src_new&&M&&(I(),j("lesson_src_new"),T(!1))},[a.lesson_src_new]),c.useEffect(()=>{_||(j(),S("type"))},[_]);const z=s=>{const d=s.target.value;d.match(/^([0-2]?[0-9]):([0-5]?[0-9]):([0-5]?[0-9])$/)&&l("duration",d)};return e.jsxs(W,{open:_,onOpenChange:()=>h(m?!0:s=>!s),children:[e.jsx(X,{children:V}),e.jsx(Z,{className:"p-0",children:e.jsxs(le,{className:"max-h-[90vh] p-6",children:[e.jsx(ee,{className:"mb-6",children:e.jsx(se,{children:i})}),e.jsx("form",{onSubmit:$,children:e.jsxs(Q,{value:r?"form":x,onValueChange:S,children:[e.jsx(D,{value:"type",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{className:"font-semibold",children:t.lesson_type}),e.jsx(L,{value:a.lesson_type,onValueChange:s=>l("lesson_type",s),className:"grid grid-cols-2 gap-3",children:R.map(s=>e.jsxs(o,{className:C("flex items-center space-x-2 rounded-lg border p-2",s.flag?"cursor-not-allowed":"cursor-pointer"),children:[e.jsx(w,{className:"cursor-pointer",value:s.value,disabled:s.flag}),e.jsx("span",{children:s.label})]},s.value))})]})}),e.jsxs(D,{value:"form",className:"space-y-4 p-0.5",children:[e.jsxs("div",{children:[e.jsxs(o,{children:[t.title," *"]}),e.jsx(b,{required:!0,name:"title",value:a.title,placeholder:t.title,onChange:s=>y(s,l)}),e.jsx(u,{message:n.title})]}),["video_url"].includes(a.lesson_type)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"lesson_provider",children:t.video_url_provider}),e.jsxs(oe,{required:!0,name:"lesson_provider",value:a.lesson_provider,onValueChange:s=>l("lesson_provider",s),children:[e.jsx(te,{className:"w-full",children:e.jsx(ie,{placeholder:t.provider_placeholder})}),e.jsx(ne,{children:e.jsx(de,{value:"youtube",children:"YouTube"})})]})]}),e.jsxs("div",{children:[e.jsxs(o,{children:["Video URL",e.jsx("span",{className:"text-xs text-gray-500",children:"(Provide the shareable url only)"})]}),e.jsx(b,{required:!0,name:"lesson_src",value:a.lesson_src||"",placeholder:`Type your ${a.lesson_provider} video url`,onChange:s=>y(s,l)}),e.jsx(u,{message:n.lesson_src})]})]}),["video","document","image"].includes(a.lesson_type)&&e.jsxs("div",{children:[e.jsxs(o,{children:[t.select," ",a.lesson_type]}),e.jsx(J,{isSubmit:m,courseId:a.course_id||"",sectionId:a.course_section_id||"",filetype:a.lesson_type,delayUpload:!0,onFileSelected:s=>{H(!0),me(s).then(d=>{l("title",d.name),l("duration",d.duration||"00:00:00")})},onFileUploaded:s=>{T(!0),l("lesson_src_new",s.file_url)},onError:s=>{p(!1)},onCancelUpload:()=>{p(!1)}})]}),a.lesson_type==="embed"&&e.jsxs("div",{children:[e.jsxs(o,{children:["Embed source",e.jsx("span",{className:"text-xs text-gray-500",children:"(Provide the source url only)"})]}),e.jsx(ue,{required:!0,name:"embed_source",placeholder:t.embed_source_placeholder,value:a.embed_source,rows:4,onChange:s=>y(s,l)}),e.jsx(u,{message:n.embed_source})]}),a.lesson_type==="text"&&e.jsxs("div",{children:[e.jsx(o,{children:t.your_text}),e.jsx(E,{ssr:!0,output:"html",placeholder:{paragraph:"Type your content here...",imageCaption:"Type caption for image (optional)"},contentMinHeight:256,contentMaxHeight:640,initialContent:a.lesson_src,onContentChange:s=>l(d=>({...d,lesson_src:s}))}),e.jsx(u,{message:n.lesson_src})]}),["video_url","video"].includes(a.lesson_type)&&e.jsxs("div",{children:[e.jsx(o,{htmlFor:"duration",children:t.duration}),e.jsx(b,{required:!0,maxLength:8,type:"text",name:"duration",value:a.duration,placeholder:"00:00:00",onChange:z,readOnly:a.lesson_type==="video"}),e.jsx(u,{message:n.duration})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"summary",children:"Summary"}),e.jsx(E,{ssr:!0,output:"html",placeholder:{paragraph:"Type your content here...",imageCaption:"Type caption for image (optional)"},contentMinHeight:256,contentMaxHeight:640,initialContent:a.summary,onContentChange:s=>l("summary",s)}),e.jsx(u,{message:n.summary})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Lesson type"}),e.jsx(L,{required:!0,defaultValue:a.is_free?"free":"paid",className:"flex items-center space-x-4 pt-2 pb-1",onValueChange:s=>l("is_free",s==="free"?1:0),children:f.prices.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{className:"cursor-pointer",id:s,value:s}),e.jsx(o,{htmlFor:s,className:"capitalize",children:s})]},s))}),e.jsx(u,{message:n.is_free})]})]}),e.jsxs(re,{className:"w-full justify-between space-x-2 pt-8",children:[e.jsxs("div",{className:"flex w-full items-center gap-4",children:[e.jsx(ae,{asChild:!0,children:e.jsx(v,{type:"button",variant:"outline",children:g.close})}),!r&&e.jsxs(ce,{className:"p-0",children:[e.jsx(U,{asChild:!0,value:"form",className:C(x==="form"?"hidden":"block"),children:e.jsx(v,{children:g.next})}),e.jsx(U,{asChild:!0,value:"type",className:C(x==="type"?"hidden":"block"),children:e.jsx(v,{children:g.back})})]})]}),(r||x==="form")&&e.jsx(K,{loading:F||m,disabled:F||m,children:m?"Uploading...":g.submit})]})]})})]})})]})};export{qe as default};
