import{r as c,u as W,b as X,j as e}from"./vendor-BBDGfIfP.js";import{C as Z}from"./chunked-uploader-input-BS9NXBbE.js";import{I as u}from"./input-error-DzlB5Qkt.js";import{L as ee}from"./loading-button-BLSSbYXc.js";import{T as se}from"./tabs-BBlGrPJc.js";import{B as y}from"./button-BxbUMaK9.js";import{D as re,a as ae,b as le,c as te,d as oe,e as ie,f as ne}from"./dialog-Ao4xhLhR.js";import{I as C}from"./input-Dldj9DiJ.js";import{L as o}from"./label-DUVUvbLf.js";import{R as k,a as U}from"./radio-group-CBkhOvCv.js";import{S as de}from"./scroll-area-Dmjd_gyP.js";import{S as ce,a as ue,b as me,c as pe,d as he}from"./select-CMFY0w3t.js";import{b as E,T as xe,a as V}from"./tabs-Dr9vs2WG.js";import{T as _e}from"./textarea-ovCXlSTO.js";import{g as fe}from"./file-metadata-CAFSN-Sn.js";import{o as S}from"./inertia-SZXqLvQm.js";import{c as N}from"./utils-fgVZ67ei.js";import{k as q}from"./richtor-QjVY_KZS.js";import"./index-G4n3qM_p.js";import"./index-BSu11NtU.js";const ge=j=>{const n=j.dashboard||{},r={video:"فيديو",video_url:"رابط فيديو",document:"مستند",image:"صورة",text:"نصي",embed:"تضمين"};return[{value:"video",label:n.video_file||r.video,flag:!1},{value:"video_url",label:n.video_url||r.video_url,flag:!1},{value:"document",label:n.document_file||r.document,flag:!1},{value:"image",label:n.image_file||r.image,flag:!1},{value:"text",label:n.text_content||r.text,flag:!1},{value:"embed",label:n.embed_source||r.embed,flag:!1}]},Be=({title:j,handler:n,lesson:r,sectionId:H})=>{var D;const[v,h]=c.useState(!1),[m,p]=c.useState(!1),[x,T]=c.useState("type"),[M,R]=c.useState(!1),[B,F]=c.useState(!1),{props:_}=W(),{translate:I}=_,{dashboard:O,input:l,button:f}=I,b=ge(I),{data:a,setData:t,post:G,put:P,reset:g,processing:L,errors:d,clearErrors:z}=X({title:r?r.title:"",status:r?r.status:"",is_free:r?r.is_free:0,description:r?r.description:"",sort:r?r.sort:_.lastLessonSort+1,lesson_type:r?r.lesson_type:"video",lesson_provider:r?r.lesson_provider:"",lesson_src:r?r.lesson_src:"",lesson_src_new:null,embed_source:r?r.embed_source:"",duration:r?r.duration:"00:00:00",summary:r?r.summary:"",course_id:r?r.course_id:_.course.id,course_section_id:H}),A=b.reduce((s,i)=>(s[i.value]=i.label,s),{}),Y=((D=b.find(s=>s.value===a.lesson_type))==null?void 0:D.label)||A[a.lesson_type]||a.lesson_type,$=l.type_video_url_placeholder||"أدخل رابط الفيديو",J=["video","document","image"].includes(a.lesson_type),K=async s=>{if(s.preventDefault(),J&&M){p(!0);return}w()},w=()=>{z(),r?P(route("lesson.update",{id:r.id}),{preserveScroll:!0,onSuccess:()=>{g(),h(!1),p(!1)}}):G(route("lesson.store"),{preserveScroll:!0,onSuccess:()=>{g(),h(!1),p(!1)}})};c.useEffect(()=>{a.lesson_src_new&&B&&(w(),g("lesson_src_new"),F(!1))},[a.lesson_src_new]),c.useEffect(()=>{v||(g(),T("type"))},[v]);const Q=s=>{const i=s.target.value;i.match(/^([0-2]?[0-9]):([0-5]?[0-9]):([0-5]?[0-9])$/)&&t("duration",i)};return e.jsxs(re,{open:v,onOpenChange:()=>h(m?!0:s=>!s),children:[e.jsx(ae,{children:n}),e.jsx(le,{className:"p-0",children:e.jsxs(de,{className:"max-h-[90vh] p-6",children:[e.jsx(te,{className:"mb-6",children:e.jsx(oe,{children:j})}),e.jsx("form",{onSubmit:K,children:e.jsxs(se,{value:r?"form":x,onValueChange:T,children:[e.jsx(E,{value:"type",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{className:"font-semibold",children:l.lesson_type}),e.jsx(k,{value:a.lesson_type,onValueChange:s=>t("lesson_type",s),className:"grid grid-cols-2 gap-3",children:b.map(s=>e.jsxs(o,{className:N("flex items-center space-x-2 rounded-lg border p-2",s.flag?"cursor-not-allowed":"cursor-pointer"),children:[e.jsx(U,{className:"cursor-pointer",value:s.value,disabled:s.flag}),e.jsx("span",{children:s.label})]},s.value))})]})}),e.jsxs(E,{value:"form",className:"space-y-4 p-0.5",children:[e.jsxs("div",{children:[e.jsxs(o,{children:[l.title," *"]}),e.jsx(C,{required:!0,name:"title",value:a.title,placeholder:l.title,onChange:s=>S(s,t)}),e.jsx(u,{message:d.title})]}),["video_url"].includes(a.lesson_type)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"lesson_provider",children:l.video_url_provider}),e.jsxs(ce,{required:!0,name:"lesson_provider",value:a.lesson_provider,onValueChange:s=>t("lesson_provider",s),children:[e.jsx(ue,{className:"w-full",children:e.jsx(me,{placeholder:l.provider_placeholder})}),e.jsx(pe,{children:e.jsx(he,{value:"youtube",children:"YouTube"})})]})]}),e.jsxs("div",{children:[e.jsxs(o,{children:[O.video_url,e.jsx("span",{className:"text-xs text-gray-500",children:l.video_url_hint})]}),e.jsx(C,{required:!0,name:"lesson_src",value:a.lesson_src||"",placeholder:$,onChange:s=>S(s,t)}),e.jsx(u,{message:d.lesson_src})]})]}),["video","document","image"].includes(a.lesson_type)&&e.jsxs("div",{children:[e.jsxs(o,{children:[l.select||"اختر"," ",Y]}),e.jsx(Z,{isSubmit:m,courseId:a.course_id||"",sectionId:a.course_section_id||"",filetype:a.lesson_type,delayUpload:!0,onFileSelected:s=>{R(!0),fe(s).then(i=>{t("title",i.name),t("duration",i.duration||"00:00:00")})},onFileUploaded:s=>{F(!0),t("lesson_src_new",s.file_url)},onError:s=>{p(!1)},onCancelUpload:()=>{p(!1)}})]}),a.lesson_type==="embed"&&e.jsxs("div",{children:[e.jsxs(o,{children:[l.embed_source,e.jsx("span",{className:"text-xs text-gray-500",children:l.embed_source_hint})]}),e.jsx(_e,{required:!0,name:"embed_source",placeholder:l.embed_source_placeholder,value:a.embed_source,rows:4,onChange:s=>S(s,t)}),e.jsx(u,{message:d.embed_source})]}),a.lesson_type==="text"&&e.jsxs("div",{children:[e.jsx(o,{children:l.your_text}),e.jsx(q,{ssr:!0,output:"html",placeholder:{paragraph:l.type_content_placeholder,imageCaption:l.image_caption_placeholder},contentMinHeight:256,contentMaxHeight:640,initialContent:a.lesson_src,onContentChange:s=>t(i=>({...i,lesson_src:s}))}),e.jsx(u,{message:d.lesson_src})]}),["video_url","video"].includes(a.lesson_type)&&e.jsxs("div",{children:[e.jsx(o,{htmlFor:"duration",children:l.duration}),e.jsx(C,{required:!0,maxLength:8,type:"text",name:"duration",value:a.duration,placeholder:"00:00:00",onChange:Q,readOnly:a.lesson_type==="video"}),e.jsx(u,{message:d.duration})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"summary",children:l.summary}),e.jsx(q,{ssr:!0,output:"html",placeholder:{paragraph:l.type_content_placeholder,imageCaption:l.image_caption_placeholder},contentMinHeight:256,contentMaxHeight:640,initialContent:a.summary,onContentChange:s=>t("summary",s)}),e.jsx(u,{message:d.summary})]}),e.jsxs("div",{children:[e.jsx(o,{children:l.lesson_pricing_type}),e.jsx(k,{required:!0,defaultValue:a.is_free?"free":"paid",className:"flex items-center space-x-4 pt-2 pb-1",onValueChange:s=>t("is_free",s==="free"?1:0),children:_.prices.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"cursor-pointer",id:s,value:s}),e.jsx(o,{htmlFor:s,className:"capitalize",children:s})]},s))}),e.jsx(u,{message:d.is_free})]})]}),e.jsxs(ie,{className:"w-full justify-between space-x-2 pt-8",children:[e.jsxs("div",{className:"flex w-full items-center gap-4",children:[e.jsx(ne,{asChild:!0,children:e.jsx(y,{type:"button",variant:"outline",children:f.close})}),!r&&e.jsxs(xe,{className:"p-0",children:[e.jsx(V,{asChild:!0,value:"form",className:N(x==="form"?"hidden":"block"),children:e.jsx(y,{children:f.next})}),e.jsx(V,{asChild:!0,value:"type",className:N(x==="type"?"hidden":"block"),children:e.jsx(y,{children:f.back})})]})]}),(r||x==="form")&&e.jsx(ee,{loading:L||m,disabled:L||m,children:m?l.uploading:f.submit})]})]})})]})})]})};export{Be as default};
